{% extends "../base.html" %}
{% load static %}
{% block content %}
  <td width="800" valign="top">
    <!-- íƒ€ì´í‹€ -->
    <div id="account-title" aria-label="í˜ì´ì§€ íƒ€ì´í‹€">
      <!-- ê°€ìš´ë° íƒ€ì´í‹€ ì´ë¯¸ì§€ -->
      <div class="title_text">ë§ˆì´í˜ì´ì§€</div>
    </div>
    <!-- ìƒë‹¨ ë°” -->
    <table align="center" width="98%">
      <tbody>
        <tr>
          <td align="right">
            <!-- íšŒì›ì •ë³´ ìˆ˜ì •: ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸ í›„ ì´ë™ -->
            <a href="{% url 'user:password_confirm' %}?next={% url 'user:profile_edit' %}">
              <img src="{% static 'images/account/my_modify.png' %}"
                   alt="ì •ë³´ìˆ˜ì •"
                   border="0"
                   width="103"
                   height="21"
                   align="absmiddle">
            </a>
            <!-- íšŒì›íƒˆí‡´: confirm í›„ ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸ â†’ íƒˆí‡´ -->
            <a href="#" onclick="member_leave(event);">
              <img src="{% static 'images/account/my_leave.png' %}"
                   alt="íšŒì›íƒˆí‡´"
                   width="68"
                   height="21"
                   border="0"
                   align="absmiddle">
            </a>
          </td>
        </tr>
      </tbody>
    </table>
    <form id="accountDeleteForm"
          method="post"
          action="{% url 'user:account_delete' %}"
          style="display:none">
      {% csrf_token %}
    </form>
    <script>
              function member_leave(e){
                if(e) e.preventDefault();
                if (confirm("ì •ë§ íšŒì›ì—ì„œ íƒˆí‡´ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
                  document.getElementById('accountDeleteForm').submit();
                }
              }
    </script>
    <!-- ê¸°ë³¸ì •ë³´ ë°•ìŠ¤ -->
    <div class="account-card">
      <div class="account-head">
        <!-- ì•„ì´ì½˜ì€ í•„ìš” ì—†ìœ¼ë©´ spanë§Œ ë‚¨ê²¨ë„ ë©ë‹ˆë‹¤ -->
        <span aria-hidden="true">ğŸ‘¤</span>
        <div class="account-head-title">íšŒì› ì •ë³´</div>
      </div>
      <div class="account-body">
        <div class="account-list">
          <div class="account-row">
            <div class="account-key">E-mail</div>
            <div class="account-val">{{ user_email }}</div>
          </div>
          <div class="account-row">
            <div class="account-key">íšŒì›ê°€ì…ì¼ì‹œ</div>
            <div class="account-val">{{ date_joined|date:"Y-m-d" }}</div>
          </div>
          <div class="account-row">
            <div class="account-key">ì—°ë½ì²˜</div>
            <div class="account-val">{{ user_hp }}</div>
          </div>
        </div>
      </div>
    </div>
    <br>
    <br>
    <br>
    <!-- ìµœê·¼ ì£¼ë¬¸ë‚´ì—­ -->
    <div class="orders-card">
      <div class="orders-head">ìµœê·¼ ì£¼ë¬¸ë‚´ì—­</div>
      <div class="orders-body">
        <table class="orders-table">
          <thead>
            <tr>
              <th>ì£¼ë¬¸ì¼ì‹œ</th>
              <th>ìƒí’ˆëª…</th>
              <!-- ğŸ”µ ì¶”ê°€ -->
              <th>ìƒí’ˆìˆ˜</th>
              <th>ì£¼ë¬¸ê¸ˆì•¡</th>
            </tr>
          </thead>
          <tbody>
            {% for od in page_obj %}
              <tr>
                <td>{{ od.created_at|date:"Y-m-d H:i" }}</td>
                <!-- ğŸ”µ ìƒí’ˆëª… ì…€: ìµœëŒ€ 2ê°œ í‘œì‹œ + ë‚˜ë¨¸ì§€ëŠ” 'ì™¸ Nê°œ' -->
                <td class="tl" style="text-align:left">
                  {% with items=od.items.all %}
                    {% if items %}
                      {% for it in items|slice:":2" %}
                        {{ it.title }}
                        {% if not forloop.last %},{% endif %}
                      {% endfor %}
                      {% with total=items|length %}
                        {% if total > 2 %}ì™¸ {{ total|add:"-2" }}ê°œ{% endif %}
                      {% endwith %}
                    {% else %}
                      -
                    {% endif %}
                  {% endwith %}
                </td>
                <td>{{ od.item_count }}</td>
                <td>{{ od.total_amount|floatformat:0 }}ì›</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="orders-empty">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% if page_obj.has_other_pages %}
      <div class="pagination">
        {% if page_obj.has_previous %}<a href="?page={{ page_obj.previous_page_number }}">ì´ì „</a>{% endif %}
        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
            <span class="current">{{ num }}</span>
          {% else %}
            <a href="?page={{ num }}">{{ num }}</a>
          {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}<a href="?page={{ page_obj.next_page_number }}">ë‹¤ìŒ</a>{% endif %}
      </div>
    {% endif %}
  </div>
</td>
{% endblock content %}
<!-- ìˆ¨ì€ í¼: CSRF í¬í•¨, POSTë¡œ ë°”ë¡œ ì „ì†¡ -->
