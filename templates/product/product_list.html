{% extends "../base.html" %}
{% load static %}
{% block content %}
  <td width="800" valign="top">
    <!--íƒ€ì´í‹€ì‹œì‘-->
    <section id="parts-hero" aria-label="í˜ì´ì§€ íƒ€ì´í‹€">
      <div class="row">
        <div class="left">
          <h1>
            <span class="chunks">
              {% if selected_manufacturer %}
                {{ selected_manufacturer }}
              {% else %}
                ìë™ì°¨ ë¶€í’ˆ
              {% endif %}
            </span>
            {% if selected_category_display %}<span class="sub">Â· {{ selected_category_display }}</span>{% endif %}
            {% if selected_model %}<span class="sub">Â· {{ selected_model }}</span>{% endif %}
            {% if selected_model_detail %}<span class="sub">Â· {{ selected_model_detail }}</span>{% endif %}
          </h1>
        </div>
        <!-- ğŸ” ìš°ì¸¡ ë ê²€ìƒ‰ -->
        <div class="right" role="search">
          <form class="search-form" method="get" action="">
            {# ê¸°ì¡´ GET íŒŒë¼ë¯¸í„° ë³´ì¡´ (që§Œ ì œì™¸) #}
            {% for k, v in request.GET.items %}
              {% if k != 'q' %}<input type="hidden" name="{{ k }}" value="{{ v }}">{% endif %}
            {% endfor %}
            <input id="heroSearch"
                   type="search"
                   name="q"
                   value="{{ request.GET.q }}"
                   placeholder="ê²€ìƒ‰"
                   autocomplete="off">
            <button type="submit">ê²€ìƒ‰</button>
          </form>
        </div>
      </div>
    </section>
    <!-- ì»¨í…ì¸  -->
    <br>
    {% if manufacturer_models or subcategory_list %}
      <div id="parts-filter">
        <!-- ì°¨ì¢… -->
        {% if manufacturer_models %}
          <div class="section">
            <span class="label">ì°¨ì¢…</span>
            <div class="chips">
              {% with top_cars=manufacturer_models|slice:":7" %}
                {% for car in top_cars %}
                  <a class="chip" href="{% url 'parts:product_by_model' car.id %}">
                    {{ car.name }} <span class="badge">{{ car.part_count }}</span>
                  </a>
                {% endfor %}
              {% endwith %}
              {% if manufacturer_models|length > 7 %}
                <button class="chip muted" id="openModelModal">+{{ manufacturer_models|length|add:"-7" }} ë”ë³´ê¸°</button>
              {% endif %}
            </div>
          </div>
        {% endif %}
        {% if subcategory_list %}
          <div class="section">
            <span class="label">ë¶€í’ˆ</span>
            <div class="chips">
              {% with top_subs=subcategory_list|slice:":6" %}
                {% for sub in top_subs %}
                  <a class="chip" href="{% url 'parts:product_by_subcategory' sub.id %}">
                    {{ sub.name }} <span class="badge">{{ sub.part_count }}</span>
                  </a>
                {% endfor %}
              {% endwith %}
              {% if subcategory_list|length > 6 %}
                <button class="chip muted" id="openPartModal">+{{ subcategory_list|length|add:"-6" }} ë”ë³´ê¸°</button>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
      <!-- ì°¨ì¢… ëª¨ë‹¬ -->
      <div id="modelModal" class="pf-modal">
        <div class="panel">
          <header>
            <strong>ëª¨ë¸ ì „ì²´ë³´ê¸°</strong>
            <button class="btn" data-close="modelModal">ë‹«ê¸°</button>
          </header>
          <div class="grid">
            {% for car in manufacturer_models %}
              <a href="{% url 'parts:product_by_model' car.id %}">
                <span>{{ car.name }}</span><span class="count">{{ car.part_count }}</span>
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
      <!-- ë¶€í’ˆ ëª¨ë‹¬ -->
      <div id="partModal" class="pf-modal">
        <div class="panel">
          <header>
            <strong>ë¶€í’ˆ ì „ì²´ë³´ê¸°</strong>
            <button class="btn" data-close="partModal">ë‹«ê¸°</button>
          </header>
          <div class="grid">
            {% for sub in subcategory_list %}
              <a href="{% url 'parts:product_by_subcategory' sub.id %}">
                <span>{{ sub.name }}</span><span class="count">{{ sub.part_count }}</span>
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
      <script>
(function(){
  function hookModal(openId, modalId){
    const modal=document.getElementById(modalId);
    const openBtn=document.getElementById(openId);
    const closeBtn=modal.querySelector('[data-close="'+modalId+'"]');
    if(openBtn){openBtn.addEventListener('click',()=>{modal.style.display='flex';});}
    if(closeBtn){closeBtn.addEventListener('click',()=>modal.style.display='none');}
    modal.addEventListener('click',e=>{if(e.target===modal) modal.style.display='none';});
  }
  hookModal('openModelModal','modelModal');
  hookModal('openPartModal','partModal');
})();
      </script>
    {% endif %}
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
      <tbody>
        <tr>
          <td>
            <div id="parts-sort" class="p_list">
              <div class="left p_list01"></div>
              <div class="right p_list02">
                <form method="get" id="sortForm">
                  <select name="sort" onchange="document.getElementById('sortForm').submit();">
                    <option value="new" {% if request.GET.sort == 'new' %}selected{% endif %}>ì‹ ìƒí’ˆìˆœ</option>
                    <option value="low_price"
                            {% if request.GET.sort == 'low_price' %}selected{% endif %}>ë‚®ì€ê°€ê²©ìˆœ</option>
                    <option value="high_price"
                            {% if request.GET.sort == 'high_price' %}selected{% endif %}>ë†’ì€ê°€ê²©ìˆœ</option>
                    <option value="title" {% if request.GET.sort == 'title' %}selected{% endif %}>ìƒí’ˆëª…ìˆœ</option>
                  </select>
                </form>
                <noscript>
                  <button type="submit">ì ìš©</button>
                </noscript>
              </div>
            </div>
            {% if products %}
              <table width="100%" cellpadding="0" cellspacing="0" border="0">
                <tbody>
                  {% for part in products %}
                    {% if forloop.first or forloop.counter0|divisibleby:4 %}<tr>{% endif %}
                      <td width="25%" align="center" valign="top">
                        <table width="25%" cellpadding="0" cellspacing="0" border="0">
                          <tbody>
                            <tr>
                              <td height="5"></td>
                            </tr>
                            <tr>
                              <td align="center" style="border:1px solid #d2d2cd;">
                                <a href="{% url 'parts:product_detail' part.pk %}">
                                  <img id="1752766397_m"
                                       src="{{ part.images.all.0.image.url }}"
                                       alt="{{ part.title }} ì´ë¯¸ì§€"
                                       width="120"
                                       height="120"
                                       border="0">
                                </a>
                              </td>
                            </tr>
                            <tr>
                              <td align="center" class="locat">
                                <a href="{% url 'parts:product_detail' part.pk %}" class="item">{{ part.title }}</a>
                              </td>
                            </tr>
                            <tr>
                              <td align="center"></td>
                            </tr>
                            <tr>
                              <td align="center" class="locat2">
                                {% if part.price == 0 %}
                                  ì „í™”ë¬¸ì˜
                                {% else %}
                                  {{ part.formatted_price }}ì›
                                {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td height="20"></td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                      {% if forloop.counter|divisibleby:4 or forloop.last %}</tr>{% endif %}
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <div align="center">
                <img src="{% static "images/parts/no_item.gif" %}"
                     border="0"
                     width=""
                     height=""
                     alt="">
              </div>
            {% endif %}
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    {% if is_paginated %}
      <form id="parts-pagination"
            method="get"
            role="navigation"
            aria-label="í˜ì´ì§€ë„¤ì´ì…˜">
        {# ë‹¤ë¥¸ GET íŒŒë¼ë¯¸í„° ë³´ì¡´ (page ì œì™¸) #}
        {% for k, v in request.GET.items %}
          {% if k != 'page' %}<input type="hidden" name="{{ k }}" value="{{ v }}">{% endif %}
        {% endfor %}
        <div class="pager">
          {# ì²˜ìŒ/ì´ì „ #}
          {% if page_obj.has_previous %}
            <button class="btn" type="submit" name="page" value="1">ì²˜ìŒ</button>
            <button class="btn"
                    type="submit"
                    name="page"
                    value="{{ page_obj.previous_page_number }}">ì´ì „</button>
          {% else %}
            <button class="btn" type="button" disabled>ì²˜ìŒ</button>
            <button class="btn" type="button" disabled>ì´ì „</button>
          {% endif %}
          {# ì•ìª½ ì—˜ë¦½ì‹œìŠ¤ #}
          {% if 1 not in page_range %}
            <button class="num" type="submit" name="page" value="1">1</button>
            <span class="dots">â€¦</span>
          {% endif %}
          {# ê°€ìš´ë° í˜ì´ì§€ë“¤ #}
          {% for num in page_range %}
            {% if num == page_obj.number %}
              <button class="num" type="button" aria-current="page">{{ num }}</button>
            {% else %}
              <button class="num" type="submit" name="page" value="{{ num }}">{{ num }}</button>
            {% endif %}
          {% endfor %}
          {# ë’¤ìª½ ì—˜ë¦½ì‹œìŠ¤ #}
          {% if paginator.num_pages not in page_range %}
            <span class="dots">â€¦</span>
            <button class="num"
                    type="submit"
                    name="page"
                    value="{{ paginator.num_pages }}">{{ paginator.num_pages }}</button>
          {% endif %}
          {# ë‹¤ìŒ/ë§¨ë #}
          {% if page_obj.has_next %}
            <button class="btn"
                    type="submit"
                    name="page"
                    value="{{ page_obj.next_page_number }}">ë‹¤ìŒ</button>
            <button class="btn"
                    type="submit"
                    name="page"
                    value="{{ paginator.num_pages }}">ë§¨ë</button>
          {% else %}
            <button class="btn" type="button" disabled>ë‹¤ìŒ</button>
            <button class="btn" type="button" disabled>ë§¨ë</button>
          {% endif %}
          <span class="stat">ì´ {{ page_obj.paginator.count }}ê°œ Â· {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
        </div>
      </form>
    {% endif %}
    <br>
  </td>
{% endblock content %}
