{% extends "../base.html" %}
{% load static humanize %}
{% block content %}
  <td width="800" valign="top">
    <div id="order-title" aria-label="페이지 타이틀">
      <!-- 가운데 타이틀 이미지 -->
      <div class="title">
        <img src="{% static 'images/parts/order_write.png' %}" alt="주문서 작성">
      </div>
    </div>
    <div id="order-summary">
      <table>
        <colgroup>
          <col>
          {# 상품 #}
          <col style="width:120px">
          {# 수량 #}
          <col style="width:160px">
          {# 단가 #}
          <col style="width:180px">
          {# 소계 #}
        </colgroup>
        <thead>
          <tr>
            <th>상품</th>
            <th>수량</th>
            <th>단가</th>
            <th>소계</th>
          </tr>
        </thead>
        <tbody>
          {% for it in cart %}
            {% with p=it.product %}
              <tr>
                <td>{{ p.title }}</td>
                <td>{{ it.qty }}</td>
                <td>
                  {% if it.price is None %}
                    <span class="warn">전화문의</span>
                  {% else %}
                    {{ it.price|floatformat:0|intcomma }}원
                  {% endif %}
                </td>
                <td>{{ it.subtotal|floatformat:0|intcomma }}원</td>
              </tr>
            {% endwith %}
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4">
              <b>총 상품금액:</b> {{ cart.total|floatformat:0|intcomma }}원
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
    <br>
    <form method="post">
      {% csrf_token %}
      {% if not is_member %}
        <fieldset style="border:1px solid #eee; padding:12px;">
          <legend>비회원 정보</legend>
          <div style="margin-bottom:8px;">
            이름
            <input type="text" name="name" required>
            &nbsp; 휴대폰
            <input type="text" name="hp" required placeholder="010-1234-5678">
            &nbsp; 이메일
            <input type="email" name="email" required>
          </div>
          <div>
            주문 비밀번호
            <input type="password" name="password" required placeholder="주문 조회용">
          </div>
        </fieldset>
        <br>
      {% else %}
        <div style="padding:8px; background:#f8fafc; border:1px solid #eee;">
          로그인 주문입니다. ({{ default_name }} / {{ default_hp }} / {{ default_email }})
        </div>
        <br>
      {% endif %}
      <div style="margin-bottom:10px;">
        요청사항(메모):
        <br>
        <textarea name="memo" rows="3" style="width:100%;"></textarea>
      </div>
      <div style="padding:12px;
                  background:#fffbea;
                  border:1px solid #fde68a;
                  border-radius:6px">
        <b>입금 안내</b>
        <br>
        주문 후 아래 계좌로 송금해주세요. 송금 후 문자로 알려주시면 관리자가 확인 후 발송합니다.
        <br>
        우리은행 1002-123-456789 (홍길동)
      </div>
      <br>
      <button type="submit" class="btn btn-primary">
        <span class="ico">🧾</span> 주문 제출
      </button>
      <a href="{% url 'shop:cart_detail' %}" class="btn">장바구니로 돌아가기</a>
    </form>
  </td>
{% endblock %}
