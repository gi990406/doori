{% extends "../base.html" %}
{% load static humanize %}
{% block content %}
  <td width="800" valign="top">
    <div id="order-title" aria-label="í˜ì´ì§€ íƒ€ì´í‹€">
      <div class="title">
        <img src="{% static 'images/parts/order_write.png' %}" alt="ì£¼ë¬¸ì„œ ì‘ì„±">
      </div>
    </div>
    <div id="order-summary">
      <table>
        <colgroup>
          <col>
          {# ìƒí’ˆ #}
          <col style="width:120px">
          {# ìˆ˜ëŸ‰ #}
          <col style="width:160px">
          {# ë‹¨ê°€ #}
          <col style="width:180px">
          {# ì†Œê³„ #}
        </colgroup>
        <thead>
          <tr>
            <th>ìƒí’ˆ</th>
            <th>ìˆ˜ëŸ‰</th>
            <th>ë‹¨ê°€</th>
            <th>ì†Œê³„</th>
          </tr>
        </thead>
        <tbody>
          {# ğŸ”´ cart ëŒ€ì‹  items ì‚¬ìš© (buy-now/ì¥ë°”êµ¬ë‹ˆ ê³µí†µ) #}
          {% for it in items %}
            {% with p=it.product %}
              <tr>
                <td>{{ p.title }}</td>
                <td>{{ it.qty }}</td>
                <td>
                  {% if it.price is None %}
                    <span class="warn">ì „í™”ë¬¸ì˜</span>
                  {% else %}
                    {{ it.price|floatformat:0|intcomma }}ì›
                  {% endif %}
                </td>
                <td>
                  {% if it.price %}
                    {{ it.subtotal|floatformat:0|intcomma }}ì›
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              {% if not it.stock_ok %}
                <tr>
                  <td colspan="4">
                    <span class="warn">âš  ì¬ê³  ë¶€ì¡±ìœ¼ë¡œ ì£¼ë¬¸ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                  </td>
                </tr>
              {% endif %}
            {% endwith %}
          {% empty %}
            <tr>
              <td colspan="4">ì£¼ë¬¸í•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4">
              <b>ì´ ìƒí’ˆê¸ˆì•¡:</b> {{ total_amount|floatformat:0|intcomma }}ì›
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
    <br>
    <form class="order-wrap"
          method="post"
          action="{% url 'shop:order_create' %}"
          novalidate>
      {% csrf_token %}
      {# buy-now ìœ ì§€ê°’ #}
      {% if buy_now_part_id %}
        <input type="hidden" name="part_id" value="{{ buy_now_part_id }}">
        <input type="hidden" name="qty" value="{{ buy_now_qty|default:1 }}">
      {% endif %}
      {% if not is_member %}
        <div class="order-card" role="group" aria-labelledby="guest-info-title">
          <div id="guest-info-title" class="order-section-title">ë¹„íšŒì› ì •ë³´</div>
          <div class="order-grid">
            <div class="order-row">
              <label class="order-label" for="guest-name">ì´ë¦„</label>
              <input class="order-input"
                     id="guest-name"
                     type="text"
                     name="guest_name"
                     required
                     autocomplete="name"
                     placeholder="í™ê¸¸ë™">
            </div>
            <div class="order-row">
              <label class="order-label" for="guest-hp">íœ´ëŒ€í°</label>
              <input class="order-input"
                     id="guest-hp"
                     type="text"
                     name="guest_hp"
                     required
                     inputmode="numeric"
                     pattern="^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$"
                     placeholder="010-1234-5678"
                     autocomplete="tel">
              <div class="order-hint">ìˆ«ìë§Œ ë˜ëŠ” í•˜ì´í”ˆ í¬í•¨ ì…ë ¥ ê°€ëŠ¥</div>
            </div>
            <div class="order-row">
              <label class="order-label" for="guest-email">ì´ë©”ì¼</label>
              <input class="order-input"
                     id="guest-email"
                     type="email"
                     name="guest_email"
                     required
                     placeholder="you@example.com"
                     autocomplete="email">
            </div>
            <div class="order-row">
              <label class="order-label" for="guest-password">ì£¼ë¬¸ ë¹„ë°€ë²ˆí˜¸</label>
              <input class="order-input"
                     id="guest-password"
                     type="password"
                     name="guest_password"
                     required
                     autocomplete="new-password"
                     placeholder="ì£¼ë¬¸ ì¡°íšŒìš© ë¹„ë°€ë²ˆí˜¸">
              <div class="order-hint">ë¹„íšŒì› ì£¼ë¬¸ ì¡°íšŒì— ì‚¬ìš©ë©ë‹ˆë‹¤.</div>
            </div>
          </div>
        </div>
      {% else %}
        <div class="order-auth-banner" role="status" aria-live="polite">
          <div class="order-auth-left">
            <div class="order-auth-text">
              <div class="order-auth-title">ë¡œê·¸ì¸ ì£¼ë¬¸ì…ë‹ˆë‹¤.</div>
              <div class="order-auth-kv">
                {{ default_name }} <span class="dot">Â·</span>
                {{ default_hp }} <span class="dot">Â·</span>
                {{ default_email }}
              </div>
            </div>
          </div>
        </div>
      {% endif %}
      <div class="order-card" role="group" aria-labelledby="memo-title">
        <div id="memo-title" class="order-section-title">ìš”ì²­ì‚¬í•­(ë©”ëª¨)</div>
        <textarea class="order-textarea"
                  name="memo"
                  rows="3"
                  placeholder="ì˜ˆ) ë°°ì†¡ ì „ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤."></textarea>
      </div>
      <div class="order-payment">
        <b>ì…ê¸ˆ ì•ˆë‚´</b>
        <br>
        <br>
        ì£¼ë¬¸ í›„ ì•„ë˜ ê³„ì¢Œë¡œ ì†¡ê¸ˆí•´ì£¼ì„¸ìš”. ì†¡ê¸ˆ í›„ ë¬¸ìë¡œ ì•Œë ¤ì£¼ì‹œë©´ ê´€ë¦¬ìê°€ í™•ì¸ í›„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
        <br>
        <br>
        ë†í˜‘ 01020108272-19 (ì •ê²½ìˆ˜)
        <br>
        ì‹ í˜‘ 01020108272 (ì •ê²½ìˆ˜)
      </div>
      <div class="order-actions">
        <button type="submit" class="btn btn-primary">ì£¼ë¬¸í•˜ê¸°</button>
        {% if using_cart %}
          <a href="{% url 'shop:cart_detail' %}" class="btn">ì¥ë°”êµ¬ë‹ˆë¡œ ëŒì•„ê°€ê¸°</a>
        {% endif %}
      </div>
    </form>
  </td>
{% endblock %}
